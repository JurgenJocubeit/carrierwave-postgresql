{"body":"# carrierwave-postgresql [![Build Status](https://secure.travis-ci.org/diogob/carrierwave-postgresql.png)](http://travis-ci.org/diogob/carrierwave-postgresql)\r\n\r\nThis gem adds to [CarrierWave](https://github.com/jnicklas/carrierwave/) a storage facility which will use the PostgreSQL's oid datatype to reference a large object residing in the databse. It supports up to 2GB files, though it's better suited for smaller ones. Makes life easier for fast prototyping and put all your data in the same place, allows one backup for all your data and file storage in heroku servers.\r\n\r\nFor more information on PostgreSQL Large Objects you can take a look at the [oficial docs](http://www.postgresql.org/docs/9.2/static/largeobjects.html)\r\n\r\n## Installation\r\n\r\nInstall the latest release:\r\n\r\n    gem install carrierwave-postgresql\r\n\r\nRequire it in your code:\r\n\r\n    require 'carrierwave/postgresql'\r\n\r\nOr, in Rails you can add it to your Gemfile:\r\n\r\n    gem 'carrierwave-postgresql'\r\n\r\n## Getting Started\r\n\r\nFirst, this extension assumes 2 important things:\r\n\r\n * You are using CarrierWave with ActiveRecord\r\n * Your database is PostgreSQL\r\n\r\nIf you fill the above requirements then you can proceed to the wonderful land of database stored files!\r\n\r\nStart off by generating an uploader:\r\n\r\n\trails generate uploader Avatar\r\n\r\nthis should give you a file in:\r\n\r\n\tapp/uploaders/avatar_uploader.rb\r\n\r\nYou can configure Carrierwave to use PostgreSQL Large Objects instead of the filesystem.\r\nJust change your uploader storage to `:postgresql_lo` as in:\r\n\r\n```ruby\r\nclass AvatarUploader < CarrierWave::Uploader::Base\r\n  storage :postgresql_lo\r\nend\r\n```\r\n\r\nAdd an oid column to the model you want to mount the uploader on:\r\n\r\n```ruby\r\nadd_column :users, :avatar, :oid\r\n```\r\n\r\n*IMPORTANT:* The table contains only an oid, which is a number referencing the large object. The file content is stored in a separate table. This is nice because it does not genrate any problem with SELECT * statements and it gives us a nice file-like interface to the large object.\r\n\r\nOpen your model file and mount the uploader:\r\n\r\n```ruby\r\nclass User < ActiveRecord::Base\r\n  mount_uploader :avatar, AvatarUploader\r\nend\r\n```\r\n\r\nNow you can cache files by assigning them to the attribute, they will\r\nautomatically be stored sinside the database using the Large Object facility when the record is saved.\r\n\r\n```ruby\r\nu = User.new\r\nu.avatar = params[:file]\r\nu.avatar = File.open('somewhere')\r\nu.save!\r\nu.avatar.url # => '/url/to/file.png'\r\nu.avatar.current_path # => 'path/to/file.png'\r\nu.avatar.identifier # => 'file.png'\r\n```\r\n\r\nFor more info on CarrierWave take a look at the main [Carrierwave repository](https://raw.github.com/jnicklas/carrierwave/).\r\n\r\n\r\n## How to stream the files from the web server\r\n\r\nSince carrierwave-postgresql doesn't make the files available via HTTP.\r\nYou can do this using the Rails engine [postgresql_lo_streamer](http://diogob.github.com/postgresql_lo_streamer/).\r\n\r\nAlternatively (in case you are not using Rails) you con stream them yourself.\r\n\r\nThe url that will be available from the field where you mounted the uploader will be the model name followed by the attribute name and with the oid as the resource id.\r\n\r\nFor instance, in the user's avatar example the url for an image with 1 as it's oid would be `/user_avatar/1`\r\n\r\nYou can retrieve the file contents using the following code:\r\n\r\n```ruby\r\nu = User.new\r\nu.avatar = params[:file]\r\nu.avatar = File.open('somewhere')\r\nu.save!\r\nu.avatar.file.read\r\n```\r\n\r\n## Contributing to carrierwave-postgresql\r\n \r\n * Check out the latest master to make sure the feature hasn't been implemented or the bug hasn't been fixed yet.\r\n * Check out the issue tracker to make sure someone already hasn't requested it and/or contributed it.\r\n * Fork the project.\r\n * Start a feature/bugfix branch.\r\n * Commit and push until you are happy with your contribution.\r\n * Make sure to add tests for it. This is important so I don't break it in a future version unintentionally.\r\n * Please try not to mess with the Rakefile, version, or history. If you want to have your own version, or is otherwise necessary, that is fine, but please isolate to its own commit so I can cherry-pick around it.\r\n\r\n## Acknowledgments\r\n\r\nThis code is largely based on [carrierwave-mongoid](https://github.com/jnicklas/carrierwave-mongoid)\r\nI wanted to thank [jnicklas](https://github.com/jnicklas) for all the open source code and for the great (and extensible) architecture of CarrierWave.\r\n\r\n## Copyright\r\n\r\nCopyright (c) 2012 Diogo Biazus. See LICENSE.txt for\r\nfurther details.\r\n\r\n","name":"Carrierwave-postgresql","tagline":"Use PostgreSQL large objects (AKA BLOBs) to store your files inside the database","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}